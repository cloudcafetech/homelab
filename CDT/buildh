

echo 'unqualified-search-registries = ["docker.io"]' >> /etc/containers/registries.conf


mkdir /tmp/vmdisk
qemu-img convert -f raw -O qcow2 /mnt/disk.img /tmp/vmdisk/rhel9-golden.qcow2

cat << END > /tmp/vmdisk/Containerfile
FROM kubevirt/container-disk-v1alpha
ADD rhel9-golden.qcow2 /disk
END

ls -l  /tmp/vmdisk/
podman build -t rhel9-golden-image:v1 -f /tmp/vmdisk/Containerfile .  

buildah build -t rhel9-golden-image:v1 /tmp/vmdisk

IID=`buildah images | grep rhel9-golden-image | grep v1 | awk '{ print $3 }'`

buildah push $IID docker://docker.io/prasenforu:v1

buildah push --tls-verify=false fedora-bashecho docker://localhost:5000/ipbabble/fedora-bashecho:latest

#buildah push  p-boss-gitlab-01.eng.tdc.net:5050/public-repositories/shared-services/public-container-image-registry/tdcnet/mysql:latest . 


cat << END > Dockerfile
FROM quay.io/buildah/stable:latest
RUN apk add --no-cache qemu-system-x86_64 bzip2 wget bash vim qemu-img bash
END

docker build -t prasenforu/buildah-qemu:v1 .

docker run -dt  buildah-qemu:v1 /bin/sh -c "echo 'Hello World'; sleep 360000"

cat << END > /tmp/Containerfile
FROM fedora
RUN dnf install -y busybox
ENV foo=bar
END

apiVersion: v1
kind: Pod
metadata:
 name: podman-priv
spec:
  containers:
  - name: priv
    #image: prasenforu/buildah-qemu:v2
    image: prasenforu/buildah-qemu:v3
    args:
      - sleep
      - "1000000"
    securityContext:
      privileged: true
    volumeMounts:  
      - mountPath: "/mnt"
        name: gipvc            
  volumes:  
  - name: gipvc
    persistentVolumeClaim:  
      claimName: pkar-vm-pvc-rwx
